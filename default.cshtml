<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Facebook Post Browser</title>
    <script src="//cdnjs.cloudflare.com/ajax/libs/moment.js/2.9.0/moment.js"></script>
    <meta name="description" content="Facebook Post Browser enables you to browse and bulk download Facebook posts for offline access. It currently supports posts created on Facebook Pages and Groups, and allows you to specify a date range of posts to load." />
    <meta name="keywords" content="facebook, facebook posts, facebook groups, facebook pages, 
    facebook export, facebook download, facebook save, facebook research, facebook browse, facebook post export, facebook post save, facebook post download" /> 
    <style type="text/css">
    #results {
      width: 100%;
    }
    #results td.description {
      word-break: break-all;
    }
    #results td.metadata {
      white-space: nowrap;
    }
    </style>
    <!-- TODO switch to CDN 
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap-theme.min.css">
    -->
   <link rel="stylesheet" href="temp/css/bootstrap.min.css">
  <link rel="stylesheet" href="temp/css/bootstrap-theme.min.css">
</head>
<body>
  <div id="fb-root"></div>
  <script type="text/javascript">
    var APPID = '@System.Configuration.ConfigurationManager.AppSettings["appId"]';
  </script>
  <script src="js/fb.js" type="text/javascript"></script>

  <div class="container">
    <h1>Facebook Post Browser</h1>
    <p class="lead">This tool enables you to browse and bulk download Facebook posts for offline access. It currently supports posts created on Facebook Pages and Groups, and allows you to specify a date range of posts to load. If you have any feedback, feature requests, or bug reports, please let us know <a href="https://feedback.userreport.com/70c370b6-b5ff-4f84-acba-843ab7f16160/" target="_blank">in our forum over here</a>.</p>
    <div class="alert alert-info" role="alert">
      <strong>Please log in</strong> with your Facebook account by pressing the button below to get started.
    </div>
    <div class="fb-login-button" data-max-rows="1" data-size="medium" data-show-faces="true" data-auto-logout-link="false" scope="user_groups" onlogin="checkLoginState();"></div>
    <br /> 
    <fieldset id="controls" class="form-group">
      <label for="objectType">Facebook Group or Page</label>
      <select id="objectType" disabled="disabled" class="form-control">
          <option value="group">Group</option>
          <option value="page">Page</option>  
      </select>
      <br/>
      <label for="objectName">Name (exact match, case insensitive)</label>
      <input type="text" id="objectName" value="شباب 6 ابريل .. APRIL 6 YOUTH MOVEMENT" disabled="disabled" class="form-control"/>
      <br />
      <label for="startDate">Start date (UTC time)</label>
      <input type="text" id="startDate" value="Jan 1, 2008" disabled="disabled" class="form-control"/>
      <br />
      <label for="endDate">End date (UTC time)</label>
      <input type="text" id="endDate" value="Mar 25, 2008" disabled="disabled" class="form-control" />
      <br />
      <label for="numPosts" >Max number of posts</label>
      <input type="text" id="numPosts" value="250" disabled="disabled" title="If you specify a large date range, there may be thousands of posts available, which will take a long time to load. Use this field to limit the number of posts returned to the 'last X' posts in the range." class="form-control"/>
      <br />
      <input type="button" id="submit" value="Submit" disabled="disabled" class="btn btn-primary"/>
    </fieldset>
    <p>Looking at <span id="resultCount">0</span> results</p>
    <table id="results" class="table table-striped">
      <thead>
        <tr>
          <th>Metadata</th>
          <th>Type</th>
          <th>From ID</th>
          <th>Details</th>
        </tr>
      </thead>
      <tbody id="posts">
      </tbody>
    </table>
  </div>  
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <!-- TODO CDN 
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
  -->
  <script src="/js/bootstrap.min.js"></script>
  <!-- Bootstrap IE10 viewport hack for Surface/desktop Windows 8 bug -->
  <!-- TODO Needs to be on CDN 
  <script src="../../assets/js/ie10-viewport-bug-workaround.js"></script>
  -->
  <script src="js/logic.js" type="text/javascript"></script>
  <script type="text/javascript">

      $(function () {
        $("#submit").click(function () {
          
          loadObjectId($("#objectName").val(), 
            $("#objectType").val(), 
            objectIdLoaded);

          ga('send', 'event', 'comments-search', 'start');
        });
      });

      function objectIdLoaded(loadObjectIdError, objectId) {    
        setCursorToProgress();

        if(!loadObjectIdError){
          loadPosts(Date.parse($("#startDate").val()), 
            Date.parse($("#endDate").val()), $("#numPosts").val(), objectId, 
            $("#objectType").val(), loadCompleted);
        } else {
          setCursorToDefault();
          alert(loadObjectIdError.message);
        }
      }

      function loadCompleted(loadPostsError, posts){
        setCursorToDefault();

        if(!loadPostsError){
          $("#posts").empty();
          $("#resultCount").html(posts.length);

          if(posts.length){
            ga('send', 'event', 'comments-search', 'completed-with-results');
          }

          $.each(posts, function (index, value) {
            var row = "<tr><td class='metadata'><strong>Id: </strong>" + value.id + "<br/>" +
            "<strong>Created Time: </strong>" + value.created_time + "</td>" +
            "<td>" + value.type + "</td>" + 
            "<td>" + value.from.id + "</td>" +
            "<td class='description'>";

            if(value.message){
              row += "<strong>Message: </strong>" + value.message + "<br/>";
            }
            if(value.link){
              row += '<strong>Link: </strong><a target="_blank" href="' + value.link + '">' + value.link + "</a><br/>";
            }
            if(value.story){
              row += "<strong>Story: </strong>" + value.story + "<br/>";
            }
            if(value.caption){
              row += "<strong>Caption: </strong>" + value.caption + "<br/>";
            }
            if(value.description){
              row += "<strong>Description: </strong>" +  value.description + "<br/>";
            }
            if(value.name){
              row += "<strong>Name: </strong>" + value.name + "<br/>";
            }
            if(value.picture){
              row += '<strong>Picture: </strong><a target="_blank" href="' + value.picture + '">' + value.picture + "</a><br/>";
            }
            row +="</td></tr>";

            $("#posts").append(row);

          });
        } else {
          alert(loadPostsError.message);
        }
      }

      function enableControls(){
        ga('send', 'event', 'facebook-login', 'success');
        $("#controls input, select").removeAttr("disabled");
      }

      function setCursorToProgress(){
        // Make cursor wait
        $("body").css("cursor", "progress");
      }

      function setCursorToDefault(){
        // Change cursor back
        $("body").css("cursor", "default"); 
      }

  </script>
  <!-- UserReport stuff -->
  <script type="text/javascript"> 
  var _urq = _urq || []; 
  _urq.push(['setGACode', 'UA-18942851-3']); 
  _urq.push(['initSite', '70c370b6-b5ff-4f84-acba-843ab7f16160']); 

  (function() { 
  var ur = document.createElement('script'); ur.type = 'text/javascript'; ur.async = true; 
  ur.src = ('https:' == document.location.protocol ? 'https://cdn.userreport.com/userreport.js' : 'http://cdn.userreport.com/userreport.js'); 
  var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ur, s); 
  })(); 
  </script>
  <!-- Google Analytics stuff -->
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-18942851-3', 'auto');
    ga('send', 'pageview');

  </script>
</body>
</html>
